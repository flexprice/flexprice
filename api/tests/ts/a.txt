=== Flexprice TypeScript SDK - API Tests (local api/typescript) ===

✓ API Key: sk_01KJF...K03S
✓ API Host: api.cloud.flexprice.io/v1

========================================
CUSTOMER API TESTS
========================================

--- Test 1: Create Customer ---
  [DEBUG Create Customer] typeof raw: object
  [DEBUG Create Customer] raw: {}
  [DEBUG Create Customer] Object.keys(raw): []
  [DEBUG Create Customer] raw.constructor?.name: Object
  [DEBUG Create Customer] raw.id: undefined
  [DEBUG Create Customer] raw.value: undefined
  [DEBUG Create Customer] unwrapped: {}

❌ Unexpected response shape

--- Test 2: Get Customer by ID ---
  [DEBUG Get Customer] typeof raw: object
  [DEBUG Get Customer] raw: {}
  [DEBUG Get Customer] Object.keys(raw): []
  [DEBUG Get Customer] raw.constructor?.name: Object
  [DEBUG Get Customer] raw.id: undefined
  [DEBUG Get Customer] raw.value: undefined
  [DEBUG Get Customer] unwrapped: {}

❌ Unexpected response shape

--- Test 3: List Customers ---
✓ Retrieved 0 customers

--- Test 4: Update Customer ---
  [DEBUG Update Customer] typeof raw: object
  [DEBUG Update Customer] raw: {}
  [DEBUG Update Customer] Object.keys(raw): []
  [DEBUG Update Customer] raw.constructor?.name: Object
  [DEBUG Update Customer] raw.id: undefined
  [DEBUG Update Customer] raw.value: undefined
  [DEBUG Update Customer] unwrapped: {}

❌ Unexpected response shape

--- Test 5: Lookup Customer by External ID ---
  [DEBUG Lookup Customer by External ID] typeof raw: object
  [DEBUG Lookup Customer by External ID] raw: {}
  [DEBUG Lookup Customer by External ID] Object.keys(raw): []
  [DEBUG Lookup Customer by External ID] raw.constructor?.name: Object
  [DEBUG Lookup Customer by External ID] raw.id: undefined
  [DEBUG Lookup Customer by External ID] raw.value: undefined
  [DEBUG Lookup Customer by External ID] unwrapped: {}

❌ Unexpected response shape

--- Test 6: Search Customers ---
✓ Found 0 customers

--- Test 7: Get Customer Entitlements ---
✓ Retrieved customer entitlements! (no features)

--- Test 8: Get Customer Upcoming Grants ---
✓ Retrieved upcoming grants! (0)

--- Test 9: Get Customer Usage ---
✓ Retrieved customer usage! (0)

✓ Customer API Tests Completed!

========================================
FEATURES API TESTS
========================================

--- Test 1: Create Feature ---
✓ Feature created successfully!
  ID: feat_01KJGD4KA7GQF4HN9G72CF27PR
  Name: Test Feature 1772224662826
  Lookup Key: test_feature_1772224662826
  Type: boolean

--- Test 2: Get Feature by ID ---
✓ Feature retrieved successfully!
  ID: feat_01KJGD4KA7GQF4HN9G72CF27PR
  Name: Test Feature 1772224662826
  Lookup Key: test_feature_1772224662826
  Created At: 2026-02-27T20:37:42.855026Z

--- Test 3: List Features ---
✓ Retrieved 10 features
  First feature: feat_01KJGD4KA7GQF4HN9G72CF27PR - Test Feature 1772224662826
  Total: 29

--- Test 4: Update Feature ---
✓ Feature updated successfully!
  ID: feat_01KJGD4KA7GQF4HN9G72CF27PR
  New Name: Test Feature 1772224662826 (Updated)
  New Description: Updated description for test feature
  Updated At: 2026-02-27T20:37:42.855026Z

--- Test 5: Search Features ---
✓ Search completed!
  Found 1 features matching ID 'feat_01KJGD4KA7GQF4HN9G72CF27PR'
  - feat_01KJGD4KA7GQF4HN9G72CF27PR: Test Feature 1772224662826 (Updated) (test_feature_1772224662826)

✓ Features API Tests Completed!

========================================
CONNECTIONS API TESTS
========================================

--- Test 1: List Connections ---
✓ Retrieved 0 connections

--- Test 2: Search Connections ---
✓ Found 0 connections

✓ Connections API Tests Completed!

========================================
PLANS API TESTS
========================================

--- Test 1: Create Plan ---
✓ Plan created successfully!
  ID: plan_01KJGD4KDCRBY7DBRDJDR4C2TS
  Name: Test Plan 1772224662928
  Lookup Key: test_plan_1772224662928

--- Test 2: Get Plan by ID ---
✓ Plan retrieved successfully!
  ID: plan_01KJGD4KDCRBY7DBRDJDR4C2TS
  Name: Test Plan 1772224662928
  Lookup Key: test_plan_1772224662928
  Created At: 2026-02-27T20:37:42.956996Z

--- Test 3: List Plans ---
✓ Retrieved 10 plans
  First plan: plan_01KJGD4KDCRBY7DBRDJDR4C2TS - Test Plan 1772224662928
  Total: 29

--- Test 4: Update Plan ---
✓ Plan updated successfully!
  ID: plan_01KJGD4KDCRBY7DBRDJDR4C2TS
  New Name: Test Plan 1772224662928 (Updated)
  New Description: Updated description for test plan
  Updated At: 2026-02-27T20:37:43.012678Z

--- Test 5: Search Plans ---
✓ Search completed!
  Found 1 plans matching ID 'plan_01KJGD4KDCRBY7DBRDJDR4C2TS'
  - plan_01KJGD4KDCRBY7DBRDJDR4C2TS: Test Plan 1772224662928 (Updated) (test_plan_1772224662928)

✓ Plans API Tests Completed!

========================================
ADDONS API TESTS
========================================

--- Test 1: Create Addon ---
✓ Addon created successfully!
  ID: addon_01KJGD4KG4Y78N2P1WWNXW33NH
  Name: Test Addon 1772224663016
  Lookup Key: test_addon_1772224663016

--- Test 2: Get Addon by ID ---
✓ Addon retrieved successfully!
  ID: addon_01KJGD4KG4Y78N2P1WWNXW33NH
  Name: Test Addon 1772224663016
  Lookup Key: test_addon_1772224663016
  Created At: 2026-02-27T20:37:43.044897Z

--- Test 3: List Addons ---
✓ Retrieved 10 addons
  First addon: addon_01KJGD4KG4Y78N2P1WWNXW33NH - Test Addon 1772224663016
  Total: 29

--- Test 4: Update Addon ---
✓ Addon updated successfully!
  ID: addon_01KJGD4KG4Y78N2P1WWNXW33NH
  New Name: Test Addon 1772224663016 (Updated)
  New Description: Updated description for test addon
  Updated At: 2026-02-27T20:37:43.044897Z

--- Test 5: Lookup Addon by Lookup Key ---
  Looking up addon with key: test_addon_1772224663016
✓ Addon found by lookup key!
  Lookup Key: test_addon_1772224663016
  ID: addon_01KJGD4KG4Y78N2P1WWNXW33NH
  Name: Test Addon 1772224663016 (Updated)

--- Test 6: Search Addons ---
✓ Search completed!
  Found 1 addons matching ID 'addon_01KJGD4KG4Y78N2P1WWNXW33NH'
  - addon_01KJGD4KG4Y78N2P1WWNXW33NH: Test Addon 1772224663016 (Updated) (test_addon_1772224663016)

✓ Addons API Tests Completed!

========================================
ENTITLEMENTS API TESTS
========================================

--- Test 1: Create Entitlement ---
  [DEBUG Create Entitlement] typeof raw: object
  [DEBUG Create Entitlement] raw: {}
  [DEBUG Create Entitlement] Object.keys(raw): []
  [DEBUG Create Entitlement] raw.constructor?.name: Object
  [DEBUG Create Entitlement] raw.id: undefined
  [DEBUG Create Entitlement] raw.value: undefined
  [DEBUG Create Entitlement] unwrapped: {}

❌ Unexpected response shape

--- Test 2: Get Entitlement by ID ---
⚠ Warning: No entitlement ID available
⚠ Skipping get entitlement test

--- Test 3: List Entitlements ---
✓ Retrieved 0 entitlements

--- Test 4: Update Entitlement ---
⚠ Warning: No entitlement ID available (create may have failed)
⚠ Skipping update entitlement test

--- Test 5: Search Entitlements ---
✓ Found 0 entitlements

✓ Entitlements API Tests Completed!

========================================
SUBSCRIPTIONS API TESTS
========================================

--- Test 1: Create Subscription ---
  [DEBUG Create Subscription] typeof raw: object
  [DEBUG Create Subscription] raw: {}
  [DEBUG Create Subscription] Object.keys(raw): []
  [DEBUG Create Subscription] raw.constructor?.name: Object
  [DEBUG Create Subscription] raw.id: undefined
  [DEBUG Create Subscription] raw.value: undefined
  [DEBUG Create Subscription] unwrapped: {}

❌ Unexpected response shape

--- Test 2: Get Subscription by ID ---
⚠ Warning: No subscription ID available
⚠ Skipping get subscription test

--- Test 3: List Subscriptions ---
✓ Retrieved 0 subscriptions

--- Test 4: Update Subscription ---
⚠ Skipping update subscription test (endpoint not available in SDK)

--- Test 4: Search Subscriptions ---
✓ Found 0 subscriptions

--- Test 5: Activate Subscription ---
⚠ Could not get draft subscription ID

--- Test 6: Add Addon to Subscription ---
⚠ Warning: No subscription or addon created
⚠ Skipping add addon test

--- Test 7: Remove Addon from Subscription ---
⚠ Skipping remove addon test (requires addon association ID)

--- Test 8: Execute Subscription Change ---
⚠ Skipping execute change test (would modify active subscription)

--- Test 9: Get Subscription Entitlements ---
⚠ Warning: No subscription created
⚠ Skipping get entitlements test

--- Test 10: Get Upcoming Grants ---
⚠ Warning: No subscription created
⚠ Skipping get upcoming grants test

--- Test 11: Report Usage ---
⚠ Warning: No subscription created
⚠ Skipping report usage test

--- Test 12: Update Line Item ---
⚠ Skipping update line item test (requires line item ID)

--- Test 13: Delete Line Item ---
⚠ Skipping delete line item test (requires line item ID)

--- Test 14: Cancel Subscription ---
⚠ Warning: No subscription created
⚠ Skipping cancel test

✓ Subscriptions API Tests Completed!

========================================
INVOICES API TESTS
========================================

--- Test 1: List Invoices ---
✓ Retrieved 0 invoices

--- Test 2: Search Invoices ---
✓ Found 0 invoices

--- Test 3: Create Invoice ---
⚠ Warning: No customer created
⚠ Skipping create invoice test

--- Test 4: Get Invoice by ID ---
⚠ Warning: No invoice ID available
⚠ Skipping get invoice test

--- Test 5: Update Invoice ---
⚠ Warning: No invoice ID available
⚠ Skipping update invoice test

--- Test 6: Preview Invoice ---
⚠ Warning: No customer available
⚠ Skipping preview invoice test

--- Test 7: Finalize Invoice ---
⚠ Could not get draft invoice ID

--- Test 8: Recalculate Invoice ---
⚠ Skipping recalculate invoice test (requires subscription invoice)

--- Test 9: Record Payment ---
⚠ Warning: No invoice ID available
⚠ Skipping record payment test

--- Test 10: Attempt Payment ---
⚠ Could not get attempt invoice ID

--- Test 11: Download Invoice PDF ---
⚠ Warning: No invoice ID available
⚠ Skipping download PDF test

--- Test 12: Trigger Invoice Communications ---
⚠ Warning: No invoice ID available
⚠ Skipping trigger comms test

--- Test 13: Get Customer Invoice Summary ---
⚠ Warning: No customer ID available
⚠ Skipping summary test

--- Test 14: Void Invoice ---
⚠ Warning: No invoice ID available
⚠ Skipping void invoice test

✓ Invoices API Tests Completed!

========================================
PRICES API TESTS
========================================

--- Test 1: Create Price ---
  [DEBUG Create Price] typeof raw: object
  [DEBUG Create Price] raw: {}
  [DEBUG Create Price] Object.keys(raw): []
  [DEBUG Create Price] raw.constructor?.name: Object
  [DEBUG Create Price] raw.id: undefined
  [DEBUG Create Price] raw.value: undefined
  [DEBUG Create Price] unwrapped: {}

❌ Unexpected response shape

--- Test 2: Get Price by ID ---
⚠ Warning: No price ID available
⚠ Skipping get price test

--- Test 3: List Prices ---
✓ Retrieved 10 prices
  First price: price_01KJGD4KN1BBGXVVWSZ9C8E3YF - 29.99 usd
  Total: 32

--- Test 4: Update Price ---
⚠ Warning: No price ID available
⚠ Skipping update price test

✓ Prices API Tests Completed!

========================================
PAYMENTS API TESTS
========================================

--- Test 1: Create Payment ---
⚠ Warning: No customer ID available
⚠ Skipping create payment test

--- Test 2: Get Payment by ID ---
⚠ Warning: No payment ID available
⚠ Skipping get payment test

--- Test 2: Search Payments ---
⚠ Skipping search payments test (endpoint not available in SDK)

--- Test 3: List Payments ---
✓ Retrieved 0 payments

--- Test 4: Update Payment ---
⚠ Warning: No payment ID available
⚠ Skipping update payment test

--- Test 5: Process Payment ---
⚠ Warning: No payment ID available
⚠ Skipping process payment test

✓ Payments API Tests Completed!

========================================
WALLETS API TESTS
========================================

--- Test 1: Create Wallet ---
⚠ Warning: No customer ID available
⚠ Skipping create wallet test

--- Test 2: Get Wallet by ID ---
⚠ Warning: No wallet ID available
⚠ Skipping get wallet test

--- Test 3: List Wallets ---
✓ Retrieved 0 wallets

--- Test 4: Update Wallet ---
⚠ Warning: No wallet ID available
⚠ Skipping update wallet test

--- Test 5: Get Wallet Balance ---
⚠ Warning: No wallet ID available
⚠ Skipping get balance test

--- Test 6: Top Up Wallet ---
⚠ Warning: No wallet ID available
⚠ Skipping top up test

--- Test 7: Debit Wallet ---
⚠ Skipping debit test (no debit endpoint in SDK)

--- Test 8: Get Wallet Transactions ---
⚠ Warning: No wallet ID available
⚠ Skipping transactions test

--- Test 9: Search Wallets ---
⚠ Search wallets returned 500 (known backend issue); skipping

✓ Wallets API Tests Completed!

========================================
CREDIT GRANTS API TESTS
========================================

--- Test 1: Create Credit Grant ---
✓ Credit grant created successfully!
  ID: cg_01KJGD4M0ETMVK550PSNC1M2NR
  Credits: 500
  Plan ID: plan_01KJGD4KDCRBY7DBRDJDR4C2TS

--- Test 2: Get Credit Grant by ID ---
✓ Credit grant retrieved successfully!
  ID: cg_01KJGD4M0ETMVK550PSNC1M2NR
  Grant Amount: N/A
  Created At: 2026-02-27T20:37:43.566704Z

--- Test 3: List Credit Grants ---
✓ Retrieved 1 credit grants for plan
  First credit grant: cg_01KJGD4M0ETMVK550PSNC1M2NR

--- Test 4: Update Credit Grant ---
✓ Credit grant updated successfully!
  ID: cg_01KJGD4M0ETMVK550PSNC1M2NR
  Updated At: 2026-02-27T20:37:43.611857Z

✓ Credit Grants API Tests Completed!

========================================
CREDIT NOTES API TESTS
========================================

--- Test 1: Create Credit Note ---
⚠ Warning: No customer ID available
⚠ Skipping create credit note test

--- Test 2: Get Credit Note by ID ---
⚠ Warning: No credit note ID available
⚠ Skipping get credit note test

--- Test 3: List Credit Notes ---
⚠ Skipping list credit notes (no query endpoint in SDK)

--- Test 4: Finalize Credit Note ---
⚠ Warning: No credit note ID available
⚠ Skipping finalize credit note test

✓ Credit Notes API Tests Completed!

========================================
EVENTS API TESTS
========================================

--- Test 1: Create Event ---
✓ Event created successfully!
  Event ID: event_01KJGD4M2B475H2CM397C4R82F
  Event Name: Test Event 1772224663601
  Customer ID: test-customer-1772224663601

--- Test 2: Query Events ---
✓ Events queried successfully!
  No events found

--- Test 3: Async Event - Simple Enqueue ---
✓ Async event enqueued successfully!
  Event Name: api_request
  Customer ID: test-customer-1772224663601

--- Test 4: Async Event - Enqueue With Options ---
✓ Async event with options enqueued successfully!
  Event Name: file_upload
  Customer ID: test-customer-1772224663601

--- Test 5: Async Event - Batch Enqueue ---
✓ Enqueued 5 batch events successfully!
  Event Name: batch_example
  Customer ID: test-customer-1772224663601
  Waiting for events to be processed...

✓ Events API Tests Completed!

========================================
CLEANUP - DELETING TEST DATA
========================================

--- Cleanup: Delete Payment ---
⚠ Skipping delete payment (no payment created)

--- Cleanup: Delete Price ---
⚠ Skipping delete price (no price created)

--- Cleanup: Delete Entitlement ---
⚠ Skipping delete entitlement (no entitlement created)

--- Cleanup: Delete Addon ---
✓ Addon deleted successfully!
  Deleted ID: addon_01KJGD4KG4Y78N2P1WWNXW33NH

--- Cleanup: Delete Plan ---
✓ Plan deleted successfully!
  Deleted ID: plan_01KJGD4KDCRBY7DBRDJDR4C2TS

--- Cleanup: Delete Feature ---
✓ Feature deleted successfully!
  Deleted ID: feat_01KJGD4KA7GQF4HN9G72CF27PR

--- Cleanup: Delete Credit Grant ---
✓ Credit grant deleted successfully!
  Deleted ID: cg_01KJGD4M0ETMVK550PSNC1M2NR

--- Cleanup: Delete Customer ---
⚠ Skipping delete customer (no customer created)

✓ Cleanup Completed!


=== All API Tests Completed Successfully! ===
